<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Administrar Asistencia INGEMAT</title>
    <link rel="stylesheet" href="../css/admin.css" />
    <link rel="stylesheet" href="../css/admin-forms.css" />
    <link rel="stylesheet" href="../css/admin-views.css" />
    <link rel="stylesheet" href="../css/admin-whatsapp.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <nav class="navbar">
      <div class="logo-ingemat">
        <a href="/"
          ><img href="/" src="../img/Logo 1x4 b&w.svg" alt="Logo INGEMAT"
        /></a>
      </div>
      <div class="nav-links">
        <button class="nav-button active" id="btn-vista-inicio">
          <i class="bi bi-house-door-fill"></i> INICIO
        </button>
        <button class="nav-button" id="btn-vista-alumnos">
          <i class="bi bi-people-fill"></i> ESTUDIANTES
        </button>
        <button class="nav-button" id="btn-vista-whatsapp">
          <i class="bi bi-whatsapp"></i> WHATSAPP
        </button>
        <button id="btn-logout" title="Cerrar Sesión">
          <i class="bi bi-box-arrow-right"></i>
        </button>
      </div>
    </nav>

    <div class="container">
      <h1>PANEL DE CONTROL</h1>

      <div id="vista-principal" class="vista-content">
        <div class="admin-grid">
          <section id="horarios-section" style="grid-area: horarios">
            <h2><i class="bi bi-clock-fill"></i> CONFIGURAR HORARIOS</h2>
            <form id="form-horarios">
              <div>
                <label
                  >Mañana - Entrada:
                  <input type="time" id="entrada-manana" required
                /></label>
                <label
                  >Mañana - Tolerancia:
                  <input type="time" id="tolerancia-manana" required
                /></label>
              </div>
              <p id="summary-manana" class="schedule-summary"></p>
              <div>
                <label
                  >Tarde - Entrada:
                  <input type="time" id="entrada-tarde" required
                /></label>
                <label
                  >Tarde - Tolerancia:
                  <input type="time" id="tolerancia-tarde" required
                /></label>
              </div>
              <p id="summary-tarde" class="schedule-summary"></p>
              <button type="submit">
                <i class="bi bi-save-fill"></i> GUARDAR HORARIOS
              </button>
            </form>
            <div id="msg-horarios"></div>
          </section>

          <section id="gestion-ciclos-section" style="grid-area: ciclos">
            <h2><i class="bi bi-calendar-range"></i> GESTIÓN DE CICLOS</h2>
            <div id="ciclos-list-container">
              <ul id="ciclos-list" class="lista-gestion-ciclos"></ul>
            </div>
            <form id="form-agregar-ciclo">
              <input
                type="text"
                id="nuevo-ciclo-nombre"
                placeholder="Nombre del nuevo ciclo"
                required
              />
              <button type="submit">
                <i class="bi bi-plus-circle-fill"></i> AGREGAR CICLO
              </button>
            </form>
            <div id="msg-ciclos"></div>
          </section>
          <section id="agregar-usuario-section" style="grid-area: agregar">
            <h2><i class="bi bi-person-plus-fill"></i> AGREGAR USUARIO</h2>
            <form id="form-agregar">
              <input type="text" id="codigo" placeholder="Código" required />
              <input
                type="text"
                id="nombre"
                placeholder="Nombre Completo"
                required
              />
              <select id="rol" required>
                <option value="">Selecciona rol</option>
                <option value="estudiante">Estudiante</option>
                <option value="docente">Docente</option>
              </select>
              <select id="turno" required>
                <option value="">Selecciona turno</option>
                <option value="mañana">Mañana</option>
                <option value="tarde">Tarde</option>
              </select>
              <select id="ciclo" required>
                <option value="">Cargando ciclos...</option>
              </select>

              <div id="dias-asistencia-selector">
                <label>Días de Asistencia:</label>
                <div class="day-buttons-container">
                  <button type="button" class="day-btn active" data-day="L">
                    L
                  </button>
                  <button type="button" class="day-btn active" data-day="M">
                    M
                  </button>
                  <button type="button" class="day-btn active" data-day="MI">
                    Mi
                  </button>
                  <button type="button" class="day-btn active" data-day="J">
                    J
                  </button>
                  <button type="button" class="day-btn active" data-day="V">
                    V
                  </button>
                  <button type="button" class="day-btn active" data-day="S">
                    S
                  </button>
                  <button type="button" class="day-btn" data-day="D">D</button>
                </div>
              </div>
              <button type="submit">
                <i class="bi bi-check-lg"></i> AGREGAR
              </button>
              <div id="msg-agregar-usuario"></div>
            </form>
          </section>

          <div id="vista-docentes-container" style="grid-area: docentes">
            <h2 class="sub-header">
              <i class="bi bi-person-badge-fill"></i> LISTA DE DOCENTES
            </h2>
            <div id="vista-docentes"></div>
          </div>

          <section id="archivos-excel-section" style="grid-area: excel">
            <h2>
              <i class="bi bi-file-earmark-excel-fill"></i> DESCARGAR ARCHIVOS
            </h2>
            <div id="archivos-excel"></div>
          </section>

          <section id="gestion-acceso-section" style="grid-area: password">
            <h2><i class="bi bi-key-fill"></i> GESTIÓN DE ACCESO</h2>
            <form id="form-password">
              <input
                type="password"
                id="nueva-password"
                placeholder="Nueva contraseña"
                required
              />
              <button type="submit">
                <i class="bi bi-pencil-square"></i> CAMBIAR CONTRASEÑA
              </button>
            </form>
            <div id="msg-password"></div>
          </section>
        </div>
      </div>

      <div
        id="vista-alumnos-completa"
        class="vista-content"
        style="display: none"
      >
        <h2 class="sub-header">
          <i class="bi bi-card-list"></i> LISTADO COMPLETO DE ALUMNOS POR CICLO
        </h2>
        <div id="vista-alumnos" class="accordion-container"></div>
      </div>

      <div id="vista-whatsapp" class="vista-content" style="display: none">
        <h2 class="sub-header">
          <i class="bi bi-whatsapp"></i> CONFIGURACIÓN DE WHATSAPP
        </h2>

        <div
          id="unsaved-changes-alert"
          class="unsaved-alert sticky"
          style="display: none"
        >
          <i class="bi bi-exclamation-triangle-fill"></i> Tienes cambios sin
          guardar en esta sección.
          <button id="btn-jump-to-save" title="Ir a Guardar">
            <i class="bi bi-arrow-down-circle"></i>
          </button>
        </div>

        <div class="whatsapp-status-section">
          <h3>
            Estado de Conexión:
            <span id="whatsapp-status-indicator" class="status-disconnected"
              >Desconectado</span
            >
          </h3>
          <p id="whatsapp-status-message">Intentando conectar...</p>
          <button id="btn-refresh-whatsapp-status" title="Refrescar Estado">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>

        <section class="whatsapp-config-section">
          <h3><i class="bi bi-toggles"></i> Activación General</h3>
          <div class="toggle-switch-container">
            <label class="switch">
              <input type="checkbox" id="whatsapp-enabled-toggle" />
              <span class="slider round"></span>
            </label>
            <span id="whatsapp-enabled-label">Notificaciones Desactivadas</span>
          </div>
        </section>

        <section class="whatsapp-config-section">
          <h3>
            <i class="bi bi-people-fill"></i> Notificaciones de Estudiantes
          </h3>
          <div id="student-rules-list">
            <p>Cargando reglas...</p>
          </div>
          <div class="add-rule-form">
            <h4><i class="bi bi-plus-circle-fill"></i> Agregar Nueva Regla</h4>
            <div class="form-grid-whatsapp">
              <select id="rule-ciclo" required>
                <option value="">Selecciona Ciclo</option>
              </select>
              <select id="rule-turno" required>
                <option value="">Selecciona Turno</option>
                <option value="mañana">Mañana</option>
                <option value="tarde">Tarde</option>
              </select>
              <select id="rule-target-type" required>
                <option value="group">Enviar a Grupo</option>
                <option value="number">Enviar a Número</option>
              </select>

              <div id="rule-group-field">
                <label for="rule-group-select">Grupo de WhatsApp:</label>
                <select id="rule-group-select">
                  <option value="">Cargando grupos...</option>
                </select>
                <input
                  type="text"
                  id="rule-group-search"
                  placeholder="Buscar grupo por nombre..."
                />
              </div>

              <div id="rule-number-field" style="display: none">
                <label for="rule-number-input">Número (ej: 519XXXXXXXX):</label>
                <input type="tel" id="rule-number-input" placeholder="519..." />
              </div>
            </div>
            <button id="btn-add-student-rule">
              <i class="bi bi-plus"></i> Agregar Regla
            </button>
            <div id="msg-add-rule" class="form-message"></div>
          </div>
        </section>

        <section class="whatsapp-config-section">
          <h3>
            <i class="bi bi-person-badge-fill"></i> Notificaciones de Docentes
          </h3>
          <div class="form-grid-whatsapp simple">
            <label for="teacher-number-input"
              >Enviar a Número (ej: 519XXXXXXXX):</label
            >
            <input
              type="tel"
              id="teacher-number-input"
              placeholder="519... (dejar vacío para no enviar)"
            />
          </div>
        </section>

        <div class="whatsapp-save-section">
          <button id="btn-save-whatsapp-config">
            <i class="bi bi-save-fill"></i> GUARDAR CONFIGURACIÓN WHATSAPP
          </button>
          <div id="msg-whatsapp-config" class="form-message"></div>
        </div>
      </div>
    </div>

    <div id="preview-modal" class="modal">
      <div class="modal-content">
        <span class="close-btn" id="close-preview">&times;</span>
        <h2>VISTA PREVIA DEL ARCHIVO</h2>
        <h3 id="preview-filename"></h3>
        <div id="preview-content" class="preview-scroll"></div>
      </div>
    </div>
    <script type="module" src="../js/admin.js"></script>
  </body>
</html>
